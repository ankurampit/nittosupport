(()=>{"use strict";const{createElement:e,useState:r,useEffect:t,Fragment:s,render:i}=wp.element,{dispatch:o,select:a}=wp.data,n=r=>e("div",{class:"lds-ellipsis"},e("div",null),e("div",null),e("div",null),e("div",null)),{createElement:l,useState:p,useEffect:d,Fragment:c,render:u}=wp.element,y=e=>{const[r,t]=p(!1),[s,i]=p(e.course),[o,a]=p("");return d((()=>{t(!0);let r=sessionStorage.getItem("course_"+e.course.id);r?(a(JSON.parse(r)),setTimeout((()=>{var r=new CustomEvent("course_card_rendered",{detail:{course:e.course}});document.dispatchEvent(r)}),100),t(!1)):fetch(`${window.course_directory.api.url}/course_card/${e.course.id}/${e.style}?client_id=${window.course_directory.api.client_id}`,{method:"get"}).then((e=>e.ok?e.json():{status:0,message:window.wplms_course_data.translations.error_loading_data})).then((r=>{t(!1),a(r),sessionStorage.setItem("course_"+e.course.id,JSON.stringify(r)),setTimeout((()=>{var r=new CustomEvent("course_card_rendered",{detail:{course:e.course}});document.dispatchEvent(r)}),100)})).catch((e=>{t(!1),console.error("Uh oh, an error!",e),dispatch("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})}))}),[e.course]),r?l(n,null):l("div",{className:"vibebp_course"},o.length?l("div",{className:"course_card",dangerouslySetInnerHTML:{__html:o},onClick:r=>{(r=>{if(o.length){var t=new CustomEvent("course_card_clicked",{detail:{original_event:r,id:e.course.id}});document.dispatchEvent(t)}})(r)}}):"")},{createContext:_}=wp.element,m=_({terms:[],update:e=>{}}),{createElement:v,useState:f,useEffect:g,Fragment:h,render:w,useContext:b}=wp.element,x=e=>{const[r,t]=f(!1),[s,i]=f({}),o=b(m);return g((()=>{i(e.term)}),[e.term]),s?v("div",{className:"taxonomy_filter"},v("div",{class:"checkbox"},v("input",{type:"checkbox",value:s.id,id:e.filter.id+"_"+s.id,checked:!!(e.args.hasOwnProperty(e.filter.property)&&e.args[e.filter.property].findIndex((r=>r.id==e.filter.id))>-1&&e.args[e.filter.property][e.args[e.filter.property].findIndex((r=>r.id==e.filter.id))].values.indexOf(s.id)>-1),onChange:r=>{let t={...s};t.active=r.target.checked,i(t),o.update(t.active,t,e.filter)}}),v("label",{for:e.filter.id+"_"+s.id,title:s.label},s.label),s.hasOwnProperty("children")&&s.children.length?s.show?v("span",{className:"vicon vicon-minus",onClick:()=>{let e={...s};e.show=!1,i(e)}}):v("span",{className:"vicon vicon-plus",onClick:()=>{let e={...s};e.show=!0,i(e)}}):""),s.hasOwnProperty("children")&&s.children.length&&s.hasOwnProperty("show")&&s.show?s.children.map(((r,t)=>v(x,{term:r,filter:e.filter,args:e.args}))):""):""},k=x,{createElement:N,useState:I,useEffect:C,Fragment:O,render:E}=wp.element,S=e=>{const[r,t]=I(!1),[s,i]=I("");C((()=>{let r=[];if(e.terms&&e.terms.length){let t=[...e.terms];t.map(((e,s)=>{if(!parseInt(e.parent)){let s={id:e.term_id,label:e.name,children:o(t,e)};r.push(s)}})),i(r)}}),[e.terms]);const o=(e,r)=>{let t=[];return e.map(((s,i)=>{s.parent==r.term_id&&t.push({id:s.term_id,label:s.name,children:o(e,s)})})),t};return s&&s.length?N(m.Provider,{value:{terms:s,update:(r,t,s)=>{e.update(r,t,e.filter,e.index)}}},s.map(((r,t)=>N(k,{term:r,filter:e.filter,args:e.args})))):""},{createElement:T,useState:A,useEffect:P,Fragment:j,render:M,useRef:$}=wp.element,{dispatch:F,select:D}=wp.data;function L(e){if(void 0===e)return!0;if("undefined"===e)return!0;if(null==e)return!0;if("boolean"==typeof e&&e)return!1;if("number"==typeof e&&0!==e)return!1;if(Array.isArray(e)||"string"==typeof e||e instanceof String)return 0===e.length;for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}const J=e=>{const[r,t]=A({posts_per_page:window.course_directory.settings.courses_per_page.size,paged:1,s:"",taxonomy:[],meta:[],orderby:window.course_directory.settings.order}),[s,i]=A(""),[o,a]=A(0),[n,l]=A(!window.course_directory.settings.hide_filters),[p,d]=A([]),[c,u]=A([]),[_,m]=A(!0),[v,f]=A([]),[g,h]=A(null),[w,b]=A(window.course_directory.settings.card_style);P((()=>{D("vibebp")?i(D("vibebp").getToken()):localforage.getItem("bp_login_token").then((e=>{i(e)}))}),[]),((e,r,t=[])=>{const s=$(Date.now());P((()=>{const t=setTimeout((function(){Date.now()-s.current>=r&&(e(),s.current=Date.now())}),r-(Date.now()-s.current));return()=>{clearTimeout(t)}}),[r,...t])})((()=>{g&&g.abort();let e={},t=new AbortController;g&&(e={signal:t.signal}),h(t),m(!0),fetch(`${window.course_directory.api.url}/courses?client_id=${window.course_directory.api.client_id}&nocache`,{method:"post",...e,body:JSON.stringify({...r,firstLoad:w,token:s})}).then((e=>e.ok?e.json():{status:0,message:window.course_directory.translations.error_loading_data})).then((e=>{w&&e.courses&&e.courses.map((e=>{e.hasOwnProperty("courseCard")&&sessionStorage.setItem("course_"+e.id,JSON.stringify(e.courseCard))})),e.status&&(u(e.courses),a(e.total)),m(!1),setTimeout((()=>{var e=new CustomEvent("course_cards_loaded",{detail:{}});document.dispatchEvent(e)}),1e3)})).catch((e=>{"AbortError"===e.name||(m(!1),F("vibebp").addNotification({text:window.course_directory.translations.error_loading_data})),console.error("Uh oh, an error!",e)}))}),500,[r,s]),P((()=>{let e=setTimeout((()=>{window.course_directory.settings.disable_scroll||(document.querySelector(".vibebp_myprofile")?document.querySelector(".applied_filters").scrollIntoView({behavior:"smooth",block:"start",inline:"center"}):document.querySelector("body").scrollIntoView({behavior:"smooth",block:"start",inline:"center"}))}),300);return()=>{clearTimeout(e)}}),[c]),P((()=>{let e=[],s=[];Object.keys(window.course_directory.settings).map((r=>{if(!L(window.course_directory.settings[r])){if("instructor"!=r&&"price"!=r||e.push({type:r}),r.indexOf("taxonomy__")>-1){let t=parseInt(window.course_directory.settings[r]);isNaN(t)?e.push({type:"taxonomy",value:r.split("__")[1]}):s.push({id:r.split("__")[1],property:"taxonomy",values:[t]})}r.indexOf("meta__")>-1&&e.push({type:"meta",value:r.split("__")[1]})}})),fetch(`${window.course_directory.api.url}/course_filters?client_id=${window.course_directory.api.client_id}&nocache`,{method:"post",body:JSON.stringify(e)}).then((e=>e.ok?e.json():{status:0,message:window.course_directory.translations.error_loading_data})).then((e=>{e.status&&("undefined"!=typeof course_directory_filters&&Array.isArray(course_directory_filters)&&course_directory_filters.map(((r,t)=>{e.filters.length&&e.filters.map(((t,s)=>{t.id==r.id&&(e.filters[s].is_active=!0)}))})),d(e.filters))})).catch((e=>{console.error("Uh oh, an error!",e),F("vibebp").addNotification({text:window.course_directory.translations.error_loading_data})}));let i={...r};if(s.length){let e={...r};s.map(((r,t)=>{e[r.property]||(e[r.property]=[]),e[r.property].push({id:r.id,values:r.values})}))}"undefined"!=typeof course_directory_filters&&Array.isArray(course_directory_filters)&&course_directory_filters.length&&course_directory_filters.map(((e,r)=>{i[e.property]||(i[e.property]=[]),i[e.property].push({id:e.id,values:e.values})})),t(i)}),[]);const x=(e,r)=>{if(e&&!p[r].ref){let t=[...p];t[r].ref=e,d(t)}};P((()=>{let e=[...p];p.map(((s,i)=>{s.ref&&"number"==s.type&&!s.init&&(e[i].init=noUiSlider.create(s.ref,{start:[0,0],connect:!0,step:1,connect:!0,tooltips:!0,format:wNumb({decimals:0}),range:{min:s.hasOwnProperty("min")?s.min:0,max:s.hasOwnProperty("max")?s.max:100}}),s.ref.noUiSlider.on("update",(function(o,a){if(0==o[0]&&0==o[1])return;let n={...r},l=-1;n[s.property]&&(l=n[s.property].findIndex((e=>e.id==s.id))),l>-1?n[s.property][l]={id:s.id,type:s.type,values:o}:(n[s.property]||(n[s.property]=[]),n[s.property].push({id:s.id,type:s.type,values:o})),e[i].is_active=!0,d(e),n.paged=1,t(n)})),d(e)),s.ref&&"date"==s.type&&!s.init&&(e[i].init=flatpickr(s.ref,{altInput:!0,mode:"range",dateFormat:"Y-m-d",onChange:o=>{if(Array.isArray(o)&&o.length>1){let a={...r};a[s.property]?a[s.property].findIndex((e=>e.id=s.id))>-1?a[s.property][a[s.property].findIndex((e=>e.id=s.id))].values=[Math.round(o[0].getTime()/1e3),Math.round(o[1].getTime()/1e3)]:a[s.property].push({id:s.id,type:s.type,values:[Math.round(o[0].getTime()/1e3),Math.round(o[1].getTime()/1e3)]}):(a[s.property]=[],a[s.property].push({id:s.id,type:s.type,values:[Math.round(o[0].getTime()/1e3),Math.round(o[1].getTime()/1e3)]})),a.paged=1,t(a),e[i].is_active=!0,d(e)}}}),d(e))}))}),[p]);const k=(e,s,i,o)=>{let a=[...p],n={...r},l=-1;n[i.property]&&(l=n[i.property].findIndex((e=>e.id==i.id))),l>-1?n[i.property][l].values.indexOf(s.id)>-1?(n[i.property][l].values.splice(n[i.property][l].values.indexOf(s.id),1),n[i.property][l].values.length||(a[o].is_active=!1,n[i.property].splice(l,1))):(n[i.property][l].values.push(s.id),a[o].is_active=!0):(n[i.property]||(n[i.property]=[]),n[i.property].push({id:i.id,type:i.type,values:[s.id]}),a[o].is_active=!0),d(p),n.paged=1,t(n)};return T("div",{className:"wplms_courses_directory_wrapper"},window.course_directory.settings.show_filters?T("div",{className:"wplms_courses_directory_filters "+(n?"active":"hide")},void 0!==window.course_directory.settings.show_filters&&p.length?T("div",{className:"wplms_courses_filter_wrapper"},p.map(((e,s)=>T("div",{className:"wplms_courses_filter"},(e=>{let s=p[e],i={...r};switch(s.type){case"checkbox":return T(j,null,T("strong",null,s.label),L(s.values)?"":"taxonomy"==s.property?T(S,{terms:s.values,index:e,update:k,args:i,filter:s}):Object.keys(s.values).map((r=>T("div",{class:"checkbox"},T("input",{type:"checkbox",value:r,id:s.id+"_"+r,checked:!!(i[s.property]&&i[s.property].findIndex((e=>e.id==s.id))>-1&&i[s.property][i[s.property].findIndex((e=>e.id==s.id))].values.indexOf(r)>-1),onChange:o=>{let a=-1,n=[...p];i[s.property]&&(a=i[s.property].findIndex((e=>e.id==s.id))),a>-1?i[s.property][a].values.indexOf(r)>-1?(i[s.property][a].values.splice(i[s.property][a].values.indexOf(r),1),i[s.property][a].values.length||(n[e].is_active=!1,i[s.property].splice(a,1))):(i[s.property][a].values.push(r),n[e].is_active=!0):(i[s.property]||(i[s.property]=[]),i[s.property].push({id:s.id,type:s.type,values:[r]}),n[e].is_active=!0),d(p),i.paged=1,t(i)}}),T("label",{for:s.id+"_"+r},s.values[r])))));case"radio":return T(j,null,T("strong",null,s.label),L(s.values)?"":Object.keys(s.values).map((o=>T("div",{class:"radio"},T("input",{type:"radio",value:o,name:s.id,id:s.id+"_"+o,checked:!!(i[s.property]&&r[s.property].findIndex((e=>e.id==s.id))>-1&&i[s.property][i[s.property].findIndex((e=>e.id==s.id))].value==o),onChange:r=>{let a=-1,n=[...p];i[s.property]&&(a=i[s.property].findIndex((e=>e.id==s.id))),a>-1?i[s.property][a].value==o?(i[s.property].splice(a,1),n[e].is_active=!1,i[s.property].splice(a,1)):(i[s.property][a].value=o,n[e].is_active=!0):(i[s.property]||(i[s.property]=[]),n[e].is_active=!0,i[s.property].push({id:s.id,type:s.type,value:o})),d(n),i.paged=1,t(i)}}),T("label",{for:s.id+"_"+o},s.values[o])))));case"showhide":return T(j,null,T("strong",null,s.label),L(s.options)?"":s.options.map((r=>T("div",{class:"radio"},T("input",{type:"radio",value:r.value,name:s.id,id:s.id+"_"+r.value,checked:!!(i[s.property]&&i[s.property].findIndex((e=>e.id==s.id))>-1&&i[s.property][i[s.property].findIndex((e=>e.id==s.id))].value==r.value),onChange:o=>{let a=[...p],n=-1;i[s.property]&&(n=i[s.property].findIndex((e=>e.id==s.id))),n>-1?(i[s.property].splice(n,1),a[e].is_active=!1):(i[s.property]||(i[s.property]=[]),i[s.property].push({id:s.id,type:s.type,value:r.value}),a[e].is_active=!0),d(a),i.paged=1,t(i)}}),T("label",{for:s.id+"_"+r.value},r.label)))));case"number":return T(j,null,T("strong",null,s.label),T("div",{className:"number_range"},T("span",null,s.min),T("span",null,s.max)),T("span",{className:"range_selector",ref:r=>{L(r)||p[e].hasOwnProperty("ref")||x(r,e)}}));case"date":return T(j,null,T("strong",null,s.label),T("input",{type:"date",ref:r=>{L(r)||p[e].hasOwnProperty("ref")||x(r,e)}}))}})(s))))):""):"",T("div",{className:"wplms_courses_directory_main"},T("div",{className:"wplms_courses_directory_header"},T("span",null,T("span",{onClick:()=>l(!n)},T("span",null,n?window.course_directory.translations.close_filters:window.course_directory.translations.show_filters),T("span",{className:n?"vicon vicon-close":"vicon vicon-plus"})),window.course_directory.settings.search_courses?T("div",{className:"wplms_courses_search"},T("input",{type:"text",placeholder:window.course_directory.translations.search_text,value:r.s,onChange:e=>{t({...r,s:e.target.value,paged:1})}}),T("span",{className:"vicon vicon-search"})):""),window.course_directory.settings.sort_options&&window.course_directory.directory_sorters?T("div",{className:"wplms_courses_sort"},T("select",{value:r.orderby,onChange:e=>{t({...r,orderby:e.target.value})}},T("option",{value:""},window.course_directory.translations.select_option),Object.keys(window.course_directory.directory_sorters).map((e=>T("option",{value:e},window.course_directory.directory_sorters[e]))))):""),T("div",{className:"applied_filters"},T("span",null,p.filter((e=>1==e.is_active)).length?p.map(((e,s)=>{if(e.is_active){if("object"==typeof e.values)return Object.keys(e.values).map((i=>{let o={...r},a=-1;if(void 0!==o[e.property]){let n=o[e.property].findIndex((r=>r.id==e.id));if(o[e.property][n].hasOwnProperty("values"))"object"==typeof o[e.property][n].values&&Array.isArray(o[e.property][n].values)&&(a="taxonomy"==e.property?o[e.property][n].values.findIndex((r=>r==e.values[i].term_id)):o[e.property][n].values.findIndex((e=>e==i)));else if(o[e.property][n].hasOwnProperty("value")&&!L(o[e.property][n].value)&&e.values.hasOwnProperty(o[e.property][n].value)&&o[e.property][n].value==i)return T("span",{onClick:()=>{let i={...r},o=[...p];o[s].is_active=!1,d(o),i[e.property].splice(i[e.property].findIndex((r=>r.id==e.id)),1),i.paged=1,t(i)}},e.values[i])}if(a>-1){let r=o[e.property].findIndex((r=>r.id==e.id));return"taxonomy"==e.property?T("span",{onClick:()=>{let i=[...p];o[e.property][r].values.splice(a,1),o[e.property][r].values.length||(i[s].is_active=!1,o[e.property].splice(r,1),d(i)),o.paged=1,t(o)}},e.values[i].name):T("span",{onClick:()=>{let i=[...p];o[e.property][r].values.splice(a,1),o[e.property][r].values.length||(i[s].is_active=!1,o[e.property].splice(r,1),d(i)),o.paged=1,t(o)}},e.values[i])}}));if("number"==e.type)return T("span",{onClick:()=>{let i={...r},o=[...p];o[s].is_active=!1,d(o),i[e.property].splice(i[e.property].findIndex((r=>r.id==e.id)),1),i.paged=1,t(i)}},e.label,Array.isArray(r[e.property])&&r[e.property].findIndex((r=>r.id==e.id))>-1?r[e.property][r[e.property].findIndex((r=>r.id==e.id))].values.map((e=>T("span",null,e))):"");if("date"==e.type)return T("span",{onClick:()=>{let i=[...p],o={...r};o[e.property].splice(o[e.property].findIndex((r=>r.id==e.id)),1),i[s].is_active=!1,d(i),o.paged=1,t(o)}},e.label)}})):"",r.s.length?T("span",{onClick:()=>{t({...nargs,s:"",paged:1})}},r.s):""),r.taxonomy.length||r.meta.length||r.s.length?T("span",{onClick:()=>{let e=[...p];e.map(((r,t)=>{e[t].is_active=!1})),d(e),t({...r,taxonomy:[],s:"",paged:1,meta:[]})}},window.course_directory.translations.clear_all):""),T("div",{className:"wplms_courses_directory "+window.course_directory.settings.card_style},_?T("div",{class:"lds-ellipsis"},T("div",null),T("div",null),T("div",null),T("div",null)):o?c.map((e=>T(y,{course:e,style:window.course_directory.settings.card_style}))):T("div",{className:"wplms_message"},T("p",null,window.course_directory.translations.no_courses_found))),o>r.posts_per_page?T("div",{class:"wplms_courses_directory_pagination"},(()=>{let e=[],s=0,i=Math.ceil(o/r.posts_per_page);o>2&&1!==r.paged&&(e.push(T("a",{className:"page",onClick:()=>{t({...r,paged:1})}},T("span",{className:"vicon vicon-angle-double-left"}))),e.push(T("a",{className:"page",onClick:()=>{r.paged>1&&t({...r,paged:r.paged-1})}},T("span",{className:"vicon vicon-angle-left"}))));for(let o=1;o<=i;o++)o===r.paged?e.push(T("span",null,o)):o<r.paged+3&&o<4||o<i&&o>i-3||o===r.paged-1||o===r.paged+1?e.push(T("a",{className:"page",onClick:()=>{t({...r,paged:o})}},o)):s||(e.push(T("a",null,"...")),s++);return o>2&&r.paged!==i&&(e.push(T("a",{className:"page",onClick:()=>{r.paged<i&&t({...r,paged:r.paged+1})}},T("span",{className:"vicon vicon-angle-right"}))),e.push(T("a",{className:"page",onClick:()=>{t({...r,paged:i})}},T("span",{className:"vicon vicon-angle-double-right"})))),e})()):""))},{createElement:U,useState:q,useEffect:V,Fragment:z,render:B}=wp.element;document.addEventListener("DOMContentLoaded",(e=>{console.log("DOMContentLoaded "),B(U(J,null),document.querySelector("#wplms_courses_directory"))})),document.addEventListener("course_directory_loaded",(()=>{console.log("captured"),B(U(J,null),document.getElementById("wplms_courses_directory"))}))})();